最近这半年，智能体很火，vibe coding也很火，相信很多园子里的小伙伴也都用上了各种AI智能体辅助编程。之前的文章[《ChatGPT Codex试用心得，码农的可靠助手or失业号角？》](https://github.com)中我也介绍过openai推出的沙盒Codex，恰逢前段时间codex-cli推出了cli版本（实际上很早就有了，但是之前的版本只能用烧api token而不是像claude code那样可以用plus账号授权使用所以一直没下载）新版本可以集成gpt-5。所以进行了尝试，有plus账号的小伙伴可以移步https://developers.openai.com/codex/cli下载安装，过程很简单，不再赘述。

今天要讲的是如何通过codex结合gpt-5的能力定位一个内存泄漏问题，我相信说到dump分析问题，大部分开发还是不太熟悉，但是却又不得不面对生产环境中遇到的各种问题，能分析dump的大佬不多，能够倾囊相授的更少（此处点赞@一线码农大佬）。当只有自己硬着头皮上的时候，那codex就可以出来表演了。

这里我采用真实项目测试，一方面是给codex上点难度（需要从真实的业务代码中定位到问题），一方面也避免过于简单的console演示不贴近生产环境。这一次演示的是托管内存泄漏，即运行的进程内存慢慢涨，确不见内存回收的场景。

![f852b64008a9198a1312c375d9969be4](https://img2024.cnblogs.com/blog/198579/202509/198579-20250905150614404-2054597661.png)

 首先我们在Common中添加一个每次运行创建521mb byte[]的函数并用一个static对象“拿住”避免GC回收来模拟内存猛涨不回收的场景

![ef611209c549ce3d68ec3e0eeb5a29bc](https://img2024.cnblogs.com/blog/198579/202509/198579-20250905150643002-140033506.png)

接着在一个每分钟执行1次的调度作业中插入这个函数调用，来模拟真实的业务中很可能“不注意”引入的元凶

![e927da54221e70bac87246e0c6a0dc7a](https://img2024.cnblogs.com/blog/198579/202509/198579-20250905150822217-2094635513.png)

一切准备就绪后，运行代码，内存很快涨到3G。右键进程创建DMP文件

![7271b11dd1b5cf2916eb7a658f1c121d]()

 接着就该codex上场了，首先把DMP文件拷贝到你的项目根目录（方便codex一边分析dump一边查代码确定问题）

然后在根目录启动你的终端，输入codex进入（安装过程不再赘述）codex沙盒环境，接着/model选择gpt-5 high

![image]()

然后输入你的问题。并告知可用工具（这里我用dotnet-dump，这里有个坑就是必须告知gpt这玩意儿要用-c exit退出，否则它傻不拉几的进入dotnet-dump的交互式命令后就卡在那了）

![b6d46c64fe95789043fd26be17cee74e]()

 然后回车后gpt-5开始列计划，开始跑任务，用户这时候只在需要的时候给gpt-5授权操作，过了一会儿。gpt-5就把问题定位到了：

![5241e2708b43adf3e1dc7267b92d0760]()

 今天的分享就到这里，有探讨需求的小伙伴可以在评论区留言

本博客参考[flyint飞数](https://flyinpro.com)。转载请注明出处！
